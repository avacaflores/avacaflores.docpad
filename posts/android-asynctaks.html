<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Conectando un servicio JSON en Android | Por puro gusto</title>
    <meta name="description" content="" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/favicon.ico">
    <link  rel="stylesheet" href="/css/screen.css" /><link  rel="stylesheet" href="/css/railscasts.css" /><link  rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <meta name="generator" content="Docpad 6.x" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Rock+Salt" />
  </head>
  <body class="post-template nav-closed">
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
      <span class="hidden">Close</span>
    </a>
    <ul>
      
        <li class="nav-any" role="presentation">
          <a href="/">Blog</a>
        </li>
      
        <li class="nav-any" role="presentation">
          <a href="/about.html">Acerca de...</a>
        </li>
      
        <li class="nav-any" role="presentation">
          <a href="/recursos.html">Recursos</a>
        </li>
      
        <li class="nav-any" role="presentation">
          <a href="/proyectos.html">Proyectos</a>
        </li>
      
    </ul>
</div>
<span class="nav-cover"></span>
    <div class="site-wrapper">
    
      <header class="main-header post-head" style="background-image: url(/img/android.png)">
  
    
  <nav class="main-nav overlay clearfix">
    
    
      <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
       
  </nav>
</header>

<main class="content" role="main">
  <article class="post">

    <header class="post-header">
      <h1 class="post-title">Conectando un servicio JSON en Android</h1>
      <section class="post-meta">
        
        <time class="post-date" datetime="2015-octubre-21">21 octubre 2015</time> | 
  <a href="/tags/android.html">android</a>, 

  <a href="/tags/json.html">json</a>, 

  <a href="/tags/asynctaks.html">asynctaks</a>, 

  <a href="/tags/java.html">java</a>, 

  <a href="/tags/movil.html">movil</a>

      </section>
    </header>
    
    <section class="post-content">
      <p>Desde hace varios años estoy dedicado &quot;en mi tiempo libre&quot; a la programación móvil especialmente en la plataforma iOS, sin embargo hace unos meses entre a un Diplomado de programación móvil y como no podía ser de otra manera uno de los módulos era programación para dispositivos Android.</p>
<p>Las tres semanas disponibles para el proyecto final del módulo fueron muy complicadas ya que tuve que no solo aprender la lógica de esta plataforma sino también entender Java (dicho sea de paso fueron mis primeras experiencia con este lenguaje de programación).</p>
<p>Uno de los requerimientos del proyecto final era el poder consumir un servicio JSON tanto para un GET como para un POST. Como siempre hay muchísima información en internet pero debido a mi poca experiencia en la plataforma me fue muy difícil entender los cientos de ejemplos.</p>
<p>A continuación les muestro el código que utilice que esta basado en AsyncTaks.</p>
<h2 id="get">GET</h2>
<pre class="highlight"><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkOperationAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncTask</span>&lt;<span class="hljs-title">Void</span>, <span class="hljs-title">Void</span>, <span class="hljs-title">String</span>&gt; </span>{

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">doInBackground</span><span class="hljs-params">(Void... params)</span> </span>{

        HttpURLConnection urlConnection = <span class="hljs-keyword">null</span>;
        BufferedReader reader = <span class="hljs-keyword">null</span>;
        Uri buildUri = Uri.parse(<span class="hljs-string">"http://www.servicio.com"</span>).buildUpon()
                .appendPath(<span class="hljs-string">"file.json"</span>).build();
        <span class="hljs-keyword">try</span> {
            URL url = <span class="hljs-keyword">new</span> URL(buildUri.toString());

            urlConnection = (HttpURLConnection) url.openConnection();
            urlConnection.setRequestMethod(<span class="hljs-string">"GET"</span>);
            urlConnection.addRequestProperty(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>);
            urlConnection.connect();

            InputStream inputStream = urlConnection.getInputStream();
            reader = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> InputStreamReader(inputStream));
            StringBuffer buffer = <span class="hljs-keyword">new</span> StringBuffer();

            String line;
            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-keyword">null</span>) {
                buffer.append(line).append(<span class="hljs-string">"\n"</span>);
            }

            <span class="hljs-keyword">return</span> buffer.toString();
        } <span class="hljs-keyword">catch</span> (IOException ex) {
            Log.e(LOG_TAG, ex.getMessage());
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (reader != <span class="hljs-keyword">null</span>) {
                    reader.close();
                }
                <span class="hljs-keyword">if</span> (urlConnection != <span class="hljs-keyword">null</span>) {
                    urlConnection.disconnect();
                }
            } <span class="hljs-keyword">catch</span> (IOException e) {
                Log.e(LOG_TAG, e.getMessage());
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}
</code></pre>
<h2 id="post">POST</h2>
<pre class="highlight"><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkOperationAsyncTaskPost</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncTask</span>&lt;<span class="hljs-title">Void</span>, <span class="hljs-title">Void</span>, <span class="hljs-title">String</span>&gt; </span>{

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">doInBackground</span><span class="hljs-params">(Void... params)</span> </span>{
        URL url;
        HttpURLConnection connection = <span class="hljs-keyword">null</span>;
        Uri buildUri = Uri.parse(<span class="hljs-string">"http://www.servicio.com"</span>).buildUpon()
                .appendPath(<span class="hljs-string">"file.json"</span>).build();
        <span class="hljs-keyword">try</span> {
            url = <span class="hljs-keyword">new</span> URL(buildUri.toString()); <span class="hljs-comment">// Create a new URL</span>
            connection = (HttpURLConnection) url.openConnection();
            connection.setRequestMethod(<span class="hljs-string">"POST"</span>);
            connection.setRequestProperty(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>);
            connection.setRequestProperty(<span class="hljs-string">"Accept-Language"</span>, <span class="hljs-string">"en-us"</span>);
            connection.setUseCaches(<span class="hljs-keyword">false</span>);
            connection.setDoInput(<span class="hljs-keyword">true</span>);
            connection.setDoOutput(<span class="hljs-keyword">true</span>);
            connection.connect();

            DataOutputStream wr = <span class="hljs-keyword">new</span> DataOutputStream(connection.getOutputStream());

            <span class="hljs-keyword">byte</span>[] outputBytes = jsonWorkPost.toString().getBytes(<span class="hljs-string">"UTF-8"</span>);

            wr.write(outputBytes);
            wr.flush();
            wr.close();

            InputStream is = connection.getInputStream();
            BufferedReader rd = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> InputStreamReader(is));
            String line;
            StringBuffer response = <span class="hljs-keyword">new</span> StringBuffer();
            <span class="hljs-keyword">while</span> ((line = rd.readLine()) != <span class="hljs-keyword">null</span>) {
                response.append(line);
                response.append(<span class="hljs-string">'\r'</span>);
            }
            rd.close();
            <span class="hljs-keyword">return</span> response.toString();

        } <span class="hljs-keyword">catch</span> (Exception e) {

            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;

        } <span class="hljs-keyword">finally</span> {

            <span class="hljs-keyword">if</span> (connection != <span class="hljs-keyword">null</span>) {
                connection.disconnect();
            }
        }
    }
}
</code></pre>

    </section>
    
    <footer class="post-footer">

      
      <figure class="author-image">
        <a class="img" href="" style="background-image: url(/img/logo.png)"><span class="hidden">Alfonso Vacaflores's Picture</span></a>
      </figure>
      

      <section class="author">
        <h4><a href="">Alfonso Vacaflores</a></h4>

        
        <div class="author-meta">
          
          <span class="author-location icon-location">Tarija, Bolivia</span>
          
          
        </div>
      </section>

      <section class="share">
        <h4>Compartir</h4>
        <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Conectando%20un%20servicio%20JSON%20en%20Android&amp;url="
          onclick="window.open(this.href + window.location.href, 'twitter-share', 'width=550,height=235');return false;">
          <span class="hidden">Twitter</span>
        </a>
        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u="
          onclick="window.open(this.href + window.location.href, 'facebook-share','width=580,height=296');return false;">
          <span class="hidden">Facebook</span>
        </a>
        <a class="icon-google-plus" href="https://plus.google.com/share?url="
          onclick="window.open(this.href + window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <span class="hidden">Google+</span>
        </a>
      </section>

    </footer>

  </article>
</main>

<aside class="read-next">
  
    
  
    
  
    
      
        <a class="read-next-story" style="background-image: url(/img/docpad.png)" href="/posts/hacking-docpad.html">
          <section class="post">
            <h2>Hacking DocPad</h2>
            <p>La primera versión de este blog fue desarrollada en **Octopress**, una plataforma muy interesante pero poco ágil desarrollada sobre&hellip;</p>
          </section>
        </a>
      
      
        <a class="read-next-story prev" style="background-image: url(/img/report.jpg)" href="/posts/ssrs-reporte-excel.html">
          <section class="post">
            <h2>Generar reportes SSRS en Excel</h2>
            <p>Abrir reportes de SSRS con la funcion `Open URL` es muy sencillo, sin embargo el hacerlo directamente en Excel&hellip;</p>
          </section>
        </a>
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</aside>

      <footer class="site-footer clearfix">
      	<div class="tagcloud">
	
		<a href="/tags/android.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> android </a>
	
		<a href="/tags/asynctaks.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> asynctaks </a>
	
		<a href="/tags/bi.html" data-tag-count="2" data-tag-weight="0.5" style="font-size: 300%;"> bi </a>
	
		<a href="/tags/blog.html" data-tag-count="3" data-tag-weight="0.7924812503605781" style="font-size: 358.49625007211563%;"> blog </a>
	
		<a href="/tags/docpad.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> docpad </a>
	
		<a href="/tags/games.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> games </a>
	
		<a href="/tags/general.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> general </a>
	
		<a href="/tags/git.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> git </a>
	
		<a href="/tags/ios.html" data-tag-count="2" data-tag-weight="0.5" style="font-size: 300%;"> ios </a>
	
		<a href="/tags/java.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> java </a>
	
		<a href="/tags/json.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> json </a>
	
		<a href="/tags/movil.html" data-tag-count="3" data-tag-weight="0.7924812503605781" style="font-size: 358.49625007211563%;"> movil </a>
	
		<a href="/tags/node-js.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> node.js </a>
	
		<a href="/tags/objective-c.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> objective-c </a>
	
		<a href="/tags/octopress.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> octopress </a>
	
		<a href="/tags/rails.html" data-tag-count="2" data-tag-weight="0.5" style="font-size: 300%;"> rails </a>
	
		<a href="/tags/reportes.html" data-tag-count="2" data-tag-weight="0.5" style="font-size: 300%;"> reportes </a>
	
		<a href="/tags/ruby.html" data-tag-count="2" data-tag-weight="0.5" style="font-size: 300%;"> ruby </a>
	
		<a href="/tags/spritekit.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> spritekit </a>
	
		<a href="/tags/ssrs.html" data-tag-count="2" data-tag-weight="0.5" style="font-size: 300%;"> ssrs </a>
	
		<a href="/tags/swift.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> swift </a>
	
		<a href="/tags/vbasic.html" data-tag-count="2" data-tag-weight="0.5" style="font-size: 300%;"> vbasic </a>
	
		<a href="/tags/web.html" data-tag-count="4" data-tag-weight="1" style="font-size: 400%;"> web </a>
	
		<a href="/tags/yaml.html" data-tag-count="1" data-tag-weight="0" style="font-size: 200%;"> yaml </a>
	
</div>
        <section class="copyright"><a href="index.html">Alfonso Vacaflores</a> &copy; 2016</section>
        <section class="poweredby">Powered by <a href="https://docpad.org">DocPad</a></section>
      </footer>

    </div>
    <script defer="defer"  src="//code.jquery.com/jquery-2.1.4.min.js"></script><script defer="defer"  src="/js/jquery.fitvids.js"></script><script defer="defer"  src="/js/index.js"></script>
  </body>
</html>